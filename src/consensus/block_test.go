package consensus

import (
	"bytes"
	"encoding/hex"
	"testing"
)

var (
	// Testnet4 Block 65,927.
	serialisedBlock, _ = hex.DecodeString(
		"00010000000000010187000000005c04daea09ff0a5d1c0c9ccef8b8457265655d0ad83cc0674b9aaec959d5987bfec8e0e808971ecd08dfcc1c3fdf79d64e5ed5439cc70b1e3e14f48fbb9acc39f075904ddc6b24e1bb63fd8af854be5f2976f4ab6afe2f38a7af6e54347733e8f18f5571d96490abdb18827c562e08a70a132983daecfe07cb3990c7c7d76f1650d7324946d3a57e8dadc45757b1d3945befb5b894bc50b97e7d94080e6cd1355bcb645b54dfe00b7b7143a3eae538e59e90e921216f762d400ec1913a78045ca7430db40000000000056abf000000000003b5d0000000010a83b80200000bef2ea3e4fb0fbca5ec1d2376ef603e35303c1b07869384e010cc8120404feb073091015943d32e7f511fe6e69c09691292212eb96c55be63bb7e94c799e9da45730df568990fab2df53fc1ed6a6cb822dea607bdb3f9d2d062a162da5aa4ac7d8d2843195209ee71767fb4d2a0d059aae282596ff6972b901fab5db528b6e4257db76e0710f755666226f31d7d9a1aa931790136db95d86e26f6e09cfbfbdca450c50300000000000000010000000000000003000000000000000200097d03927ae0e5dae4ae0c329daa41172410b8213cc8aac5af5ce149cf3ada3f0200081175fcf8c335ff7839d035c9fdecef7f93e2dd0a0a9d08f659cdb61c2e63605800000000000002a3460abccbe856f51f0a4248d8aaa93b171f66b9e51fa75492acb24a436c84baf7e6c23f316124966ed9b36e7ad46f0516c39c4863bf472536df28faff947a3a3e065dcdc47bd1a9ab96bdfdfb9ea8ad25cdd0cab8eee308f90073469c758ad480301764f2109cd6ae0e7584640bd1833eae0507cf04f4c5c0380e1672940bf88b091726c10fee3b9bf217596a20813037d661091c3d89e743ac4ba0c159e4d8aefb35bbd11c46a9291ac5f8f1bd6932eb666f7847ef846a686ea4a0d711b359a2992b57c52e10e88455fd777945394a6de004f336d3b603dcfb2d2e30fea46f6d185ffd21e3d757a26d9d5fd3617f586a2a0ef8a29015c971e67ecdb184c18b6471a08af4de37bc50dd4c2e578354bcd23e1a2cb66b84fb6d4e2aa429a0095306d027ba6ad1e4de3402337182c03adc0d970fa624e866468e4d07081462773002da6ff8c8ece6746f8f65131bdd55309c7b6b204c0d224d70ebdf84a523a32e1fa5250357eaa7554c7d12010218af014f2f2f147ca506747b356c3b83510b9ab394239faa4f9ff1962bc8dd798d6cb1a2c1541bf2acb8134a4354e4814827e7374ac3d909eb8b6b8596462570aa2243364dc657963609fc5cecae625b97bf7533810177a487939b1c928cb7c66ac9a443b8a62b4bcd859ba5b888e069636a349e59d46bc1cc62612bf20fb8153d2c3029e776c21aae62f3e4d07aab6d747bdafca348de971200686c27f72fd405361e47eb3f795d9bba78d96a6b7489a05f1449dcbda37a08d4a8070d0a0381317221161ba0cc57c22819a43d4167da2d6b8f78088bb006ffc88cee29abf41286a20121fe34518692438bd88420f78c500a6927ea2b603bfd30996631b8cf27eeb26459aab2c328dd2eb060672f80ce7ecaab0f569ec1702bd486204529baec0bd7d2eded0ee7f32020217089213b6d2fce379a7315be0108bfd392f055a4870d75b447db31c59daa27eda8471f40dcfcb3a8fa399ae0afe100000000000002a3fd3b70fa382fa153ed195eb2d21fa0a3c275ad16c9aebe32f76f1e3f69e3e934f35bc21360b456da9a982d01b25dfb1868b6154bd4b5eebd1b8d7b907a6ea1510416213cf947b28234130e390c2a4893ac399b36718d3d2ca9d894fb2bb512fa741258da97a1b4697db3a72ab3bb081aa408ae5566c06a3fdecb0281463d329371331d5d7c5bed3a9493f2998314c83f7c7c42ecf2d5d1e1bfefe8987628b7ff0578ce51e718f15639d849423158623bb78e82cf622b10258458342eebf162496d223a1e296753eaeb6d231714455bfd5ee31d574642cb31d25458d8a0ddf4c4ea6aab4ace94a92435fd4e6bebe5f9f5d7bc8e18320d72288297a486586f06c78a00957b34529750cfe4824b79589587f54e9082e88d6e20eec484197cdb8ea418622f27a74489061040a23e5b234a8ac220807bdad3387398417b1e92a6d6ecbbad59967c19f7ec8fb214cb11403b4927c17d2e7367b8354c1dd42a5306c2ab19fd01226fe8cbbccc1ab2054016ba748377f74d9365f40f0b8771f33c5199c492253504cd9e369f456c560ae1958764e71f1e5a7060f072882fb7cc08d1975e4a27350d6a9a2895626fe480d5d7107976ca57fc489f17212cd20ce3041e9bf77c3a15f2ca654c980ee97fb600310caf01091a66db2ef065e89f51b7e3c6670a042ef55e803a1d443e051efc9803f5610dd358beb251aa0edb58133f0a46869b4a08e46d2ae974bfc9e6cdd1e7af6eda4dc9fde07fa0f6a5ace4d8f43bcd019df4939e7d990f4d2828cc83fd0cc47369a13b71e212c142927df67faf280ea071c3043980e3fd1955398aeb1df7f769526dfb3ad4851b94d0e1e3c452b699407fec48d6ac8593b505c774a4f0a60dd63c0aa11cc12c7a201856f80c0423e73aa42dde50502aefb9c0276ecb4508ed6f22927767c791cd4535adabe5b6695076c5ec0aa90008c1806612f951ecc80f7f4e9258b4d089713bd19094cd8829ffe4ba7c02e9e81300000000000002a3f6fff7b0775aca3d2db82e41f28cca051f3a479ec229e1d18445b8fb2c9fb3658b31fb733c7511364210c937a17dffe30850281af266f5cc9f82328a1440c42b0933fc288d720a6a4b60715bca84d36ca3e578ef61ca8cd8444d0289586dc82cd1d55d007f15d1e76a1a6c9287d11f2be6dcc5531e65eabdf63a1463860a694a59a7e48d3ed7c324aaad92f58f11394874b7b9f982af598b70c450c26b978311df16f9586a8d60290017a20b5b3c73028716d450b1767a4d20d76f4cce34ad7d9fe3e983191f3bdf2b40fa8049cc58f8bc27fd389101bb12ded0106556f6a494baf2dbc89910fada29c8faf8bee9ffcff5736085fe37018fe3bd48f5b71f10f47079b2db98b89480dcaa09e85c6aa6ec2ee9ca71b912ecaae2e2700d090905b0e999eea68ed40a9ddbf5c0509c86c122cc4ecfe94b86d705aa463de2ddfddc4083cc731b300a7ebe01fb1a6c42bbd730e21246f6a84aafd1f21d7abd8cb94f4bb37b008919348436d7b9c477694d44c4ffca00c452d2940ed35c1006f9d1b4d583748585525c8febc321ffd75d802bf15772e3458ed478dd08456e3048358eb8740d5260b599a8e7f200e0a3a3136b5f8cf2b286b73eac5c59f0ee52e64483d5ca3a874075098258994fb4d3262483997f0ef8a118445a3f3923dd7805f2d75f4a0163eb9c6871c3ce111b4593d2a9f42817efac9a65c1a1324405307ca25189ec4aee9f5bef1711021cc83a86db752e1f141a0edef9ee3ae04496822a888a9b5cf412225f300eeee906558a40251a96a618cc23d67c48f23d5bb1ea172df5a2445cb9cd745c3736a7b44a263e721a5caf7e35e83bed527555be62eeca7c9f07e8f827bfbc5ae006b03d52c934c333ca564ca532c6e3d0f0ad85acdc9834bdd95c91b3cc13a6b5f0b101575f3921a8173c778428a98bfe9e5666a65fa39d4dddb7f29d0000000000007a1200000000000001018508dfc4fe50a03eddd23a2a6b167d5ffdcc065a725c4e1c42904dcbc80270d78b16684c83b88bda7443c376dbf4d25be1412935221d66ab0c86cc52756701920c93072d8632a5c25ae43bcbca2732b84b007d884a37c38601f244c957c3401b9f50010000000000000000000000000001018709df142550facc1868d6cdf838b481b7841e240d55eeecbe865e9e646d2a26584fb4dd7951d4f06cf9afd71068a303fdd2d7f1636c83a879d7f41dabdbce6c34df05e3b39d3893c390e938d50760aa0a68a28d5213e2ee7c808232c8bea090c2a8")
)

func TestBlockValidate(t *testing.T) {
	block := &Block{}
	if err := block.Read(bytes.NewReader(serialisedBlock)); err != nil {
		t.Errorf("failed to deserialize block: %v", err)
	}

	if err := block.Validate(); err != nil {
		t.Errorf("TestBlockValidate failed: %v", err)
	}
}

func TestBlockSerialize(t *testing.T) {
	block := &Block{}
	if err := block.Read(bytes.NewReader(serialisedBlock)); err != nil {
		t.Errorf("failed to deserialize block: %v", err)
	}

	actual := block.Bytes()
	for i := range serialisedBlock {
		if serialisedBlock[i] != actual[i] {
			t.Errorf("TestBlockSerialize failed: mismatch at byte %d, got\n%x"+
				", expected\n%x", i, actual, serialisedBlock)
			break
		}
	}
}
